<!DOCTYPE html>
<html>
  <head>
    <title>vastimg.heroku.com</title>
    <style>
      body {
        margin:0;
        padding:0;
        background:#000
      }
      img {
        position:absolute;
        top:0;
        left:0;
        height:100%;
        width:100%;
        border:0;
        /* secret to everything basically */
        image-rendering:-moz-crisp-edges;
        image-rendering:-webkit-optimize-contrast;
        -ms-interpolation-mode:nearest-neighbor
      }
      form {
        padding:30px;
        border:8px solid #000;
        background:#fff;
        position:absolute;
        width:25%;
        height:25%;
        top:33%;
        left:33%;
        opacity:0;
      }
      input {
        font-size:40px;
        opacity:1;
        width:90%;
        color:#fff;
        border:0;
      }
    </style>
  </head>
  <body>
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
    <form><input type='text'></form>
    <script type="text/javascript">
      (function () {
        var query = document.location.search,
              src = query.substring(1, query.length),
              img = document.getElementsByTagName('img')[0],
             form = document.getElementsByTagName('form')[0],
            input = document.getElementsByTagName('input')[0],
              log = console ? console.log.bind(console) : function () {}
        img.src = src
        document.onkeydown = function (ev) {
          if (ev.keyCode == 32 || (ev.keyCode >= 37 && ev.keyCode <= 40)) {
            document.onkeydown = null
            location.href = '/'
          } else {
            console.log(ev.keyCode)
          }
        }

        input.value = src
        input.select()
        input.focus()
        function check() {
          if (input.value != src) {
            input.style.display = 'none'
            if (receive(input.value))
              return
            log('bzzt: ' + input.value)
            input.value = src
            input.style.display = ''
            input.select()
            input.focus()
          }
          input.select()
          setTimeout(check, 100)
        }
        check()

        var preview = document.createElement("img")
        function receive(text) {
          var url = text.trim()
          if (url.match(/^(?:https?|data):/)) {
            location.href = '/?' + url
            return url
          }
        }

        log('paste me an img')
      })()
    </script>
  </body>
</html>
